{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport App from 'next/app';\nimport React from 'react';\nimport { Provider } from 'react-redux';\nimport nextCookie from 'next-cookies';\nimport withReduxSaga from '.../redux/withReduxSaga';\nimport BaseLayout from '@layouts/base-layout';\nimport { authService, userService, settingService } from '@services/index';\nimport Router from 'next/router';\nimport { loginSuccess } from '.../redux/auth/actions';\nimport { updateCurrentUser } from '.../redux/user/actions';\nimport { updateUIValue } from '.../redux/ui/actions';\nimport { Socket } from 'src/socket';\nimport Head from 'next/head';\nimport { SETTING_KEYS } from 'src/constants';\nimport { pick } from 'lodash';\nimport { updateLiveStreamSettings } from '.../redux/streaming/actions';\nimport { updateSettings } from '@redux/settings/actions';\nimport '../style/index.less';\nimport { setGlobalConfig } from '@services/config';\n\nfunction redirectLogin(ctx) {\n  if (true) {\n    authService.removeToken();\n    Router.push('/');\n    return;\n  } // fix for production build\n\n\n  ctx.res.clearCookie && ctx.res.clearCookie('token');\n  ctx.res.clearCookie && ctx.res.clearCookie('role');\n  ctx.res.writeHead && ctx.res.writeHead(302, {\n    Location: '/'\n  });\n  ctx.res.end && ctx.res.end();\n}\n\nfunction auth(_x, _x2, _x3) {\n  return _auth.apply(this, arguments);\n}\n\nfunction _auth() {\n  _auth = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(ctx, noredirect, onlyPerformer) {\n    var store, state, _nextCookie2, token, user;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            store = ctx.store;\n            state = store.getState();\n            _nextCookie2 = nextCookie(ctx), token = _nextCookie2.token;\n\n            if (!(state.auth && state.auth.loggedIn)) {\n              _context2.next = 6;\n              break;\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 6:\n            if (!token) {\n              _context2.next = 20;\n              break;\n            }\n\n            authService.setToken(token);\n            _context2.next = 10;\n            return userService.me({\n              Authorization: token\n            });\n\n          case 10:\n            user = _context2.sent;\n\n            if (!(!user.data || !user.data._id)) {\n              _context2.next = 14;\n              break;\n            }\n\n            redirectLogin(ctx);\n            return _context2.abrupt(\"return\");\n\n          case 14:\n            if (!(!user.data.isPerformer && onlyPerformer)) {\n              _context2.next = 17;\n              break;\n            }\n\n            redirectLogin(ctx);\n            return _context2.abrupt(\"return\");\n\n          case 17:\n            store.dispatch(loginSuccess());\n            store.dispatch(updateCurrentUser(user.data));\n            return _context2.abrupt(\"return\");\n\n          case 20:\n            !noredirect && redirectLogin(ctx);\n            _context2.next = 26;\n            break;\n\n          case 23:\n            _context2.prev = 23;\n            _context2.t0 = _context2[\"catch\"](0);\n            redirectLogin(ctx);\n\n          case 26:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[0, 23]]);\n  }));\n  return _auth.apply(this, arguments);\n}\n\nfunction updateSettingsStore(_x4, _x5) {\n  return _updateSettingsStore.apply(this, arguments);\n}\n\nfunction _updateSettingsStore() {\n  _updateSettingsStore = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(ctx, settings) {\n    var store;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            store = ctx.store;\n            store.dispatch(updateUIValue({\n              logo: settings.logoUrl || '',\n              siteName: settings.siteName || '',\n              favicon: settings.favicon || '',\n              loginPlaceholderImage: settings.loginPlaceholderImage || '',\n              menus: settings.menus || [],\n              footerContent: settings.footerContent || '',\n              countries: settings.countries || [],\n              userBenefit: settings.userBenefit || '',\n              modelBenefit: settings.modelBenefit || ''\n            }));\n            store.dispatch(updateLiveStreamSettings(pick(settings, [SETTING_KEYS.VIEWER_URL, SETTING_KEYS.PUBLISHER_URL, SETTING_KEYS.SUBSCRIBER_URL, SETTING_KEYS.OPTION_FOR_BROADCAST, SETTING_KEYS.OPTION_FOR_PRIVATE, SETTING_KEYS.SECURE_OPTION, SETTING_KEYS.ANT_MEDIA_APPNAME, SETTING_KEYS.AGORA_APPID, SETTING_KEYS.AGORA_ENABLE])));\n            store.dispatch(updateSettings(pick(settings, [SETTING_KEYS.REQUIRE_EMAIL_VERIFICATION, SETTING_KEYS.TOKEN_CONVERSION_RATE, SETTING_KEYS.STRIPE_PUBLISHABLE_KEY, SETTING_KEYS.GOOGLE_RECAPTCHA_SITE_KEY, SETTING_KEYS.ENABLE_GOOGLE_RECAPTCHA, SETTING_KEYS.GOOGLE_CLIENT_ID, SETTING_KEYS.TWITTER_CLIENT_ID, SETTING_KEYS.PAYMENT_GATEWAY, SETTING_KEYS.META_KEYWORDS, SETTING_KEYS.META_DESCRIPTION])));\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _updateSettingsStore.apply(this, arguments);\n}\n\nvar publicConfig = {};\n\nvar Application = /*#__PURE__*/function (_App) {\n  _inherits(Application, _App);\n\n  var _super = _createSuper(Application);\n\n  function Application(props) {\n    var _this;\n\n    _classCallCheck(this, Application);\n\n    _this = _super.call(this, props);\n    setGlobalConfig(_this.props.config);\n    return _this;\n  }\n\n  _createClass(Application, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          Component = _this$props.Component,\n          pageProps = _this$props.pageProps,\n          store = _this$props.store,\n          settings = _this$props.settings;\n      var layout = Component.layout;\n      return __jsx(Provider, {\n        store: store\n      }, __jsx(Head, null, __jsx(\"title\", null, settings === null || settings === void 0 ? void 0 : settings.siteName), __jsx(\"meta\", {\n        name: \"viewport\",\n        content: \"width=device-width, initial-scale=1, maximum-scale=1\"\n      }), settings && settings.gaCode && [__jsx(\"script\", {\n        async: true,\n        src: \"https://www.googletagmanager.com/gtag/js?id=\".concat(settings.gaCode)\n      }), __jsx(\"script\", {\n        // eslint-disable-next-line react/no-danger\n        dangerouslySetInnerHTML: {\n          __html: \"\\n                 window.dataLayer = window.dataLayer || [];\\n                 function gtag(){dataLayer.push(arguments);}\\n                 gtag('js', new Date());\\n                 gtag('config', '\".concat(settings.gaCode, \"');\\n             \")\n        }\n      })], settings && settings.headerScript && // eslint-disable-next-line react/no-danger\n      __jsx(\"div\", {\n        dangerouslySetInnerHTML: {\n          __html: settings.headerScript\n        }\n      })), __jsx(Socket, null, __jsx(BaseLayout, {\n        layout: layout,\n        maintenance: settings.maintenanceMode\n      }, __jsx(Component, pageProps))), settings && settings.afterBodyScript && // eslint-disable-next-line react/no-danger\n      __jsx(\"div\", {\n        dangerouslySetInnerHTML: {\n          __html: settings.afterBodyScript\n        }\n      }));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: // TODO - consider if we need to use get static props in children component instead?\n    // or check in render?\n    function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n        var Component, ctx, dotenv, myEnv, noredirect, onlyPerformer, authenticate, _nextCookie, token, settings, _yield$Promise$all, _yield$Promise$all2, setting, pageProps;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                Component = _ref.Component, ctx = _ref.ctx;\n\n                // load configuration from ENV and put to config\n                if (!true) {\n                  // eslint-disable-next-line global-require\n                  dotenv = require('dotenv');\n                  myEnv = dotenv.config().parsed; // publish to server config with app\n\n                  setGlobalConfig(myEnv); // load public config and api-endpoint?\n\n                  Object.keys(myEnv).forEach(function (key) {\n                    if (key.indexOf('NEXT_PUBLIC_') === 0) {\n                      publicConfig[key] = myEnv[key];\n                    }\n                  });\n                } // won't check auth for un-authenticated page such as login, register\n                // use static field in the component\n\n\n                noredirect = Component.noredirect, onlyPerformer = Component.onlyPerformer, authenticate = Component.authenticate;\n\n                if (!(authenticate !== false)) {\n                  _context.next = 6;\n                  break;\n                }\n\n                _context.next = 6;\n                return auth(ctx, noredirect, onlyPerformer);\n\n              case 6:\n                _nextCookie = nextCookie(ctx), token = _nextCookie.token;\n                ctx.token = token || ''; // server side to load settings, once time only\n\n                settings = {};\n\n                if (true) {\n                  _context.next = 18;\n                  break;\n                }\n\n                _context.next = 12;\n                return Promise.all([settingService.all('all', true)]);\n\n              case 12:\n                _yield$Promise$all = _context.sent;\n                _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 1);\n                setting = _yield$Promise$all2[0];\n                settings = _objectSpread({}, setting.data);\n                _context.next = 18;\n                return updateSettingsStore(ctx, settings);\n\n              case 18:\n                pageProps = {};\n\n                if (!Component.getInitialProps) {\n                  _context.next = 23;\n                  break;\n                }\n\n                _context.next = 22;\n                return Component.getInitialProps({\n                  ctx: ctx\n                });\n\n              case 22:\n                pageProps = _context.sent;\n\n              case 23:\n                return _context.abrupt(\"return\", {\n                  settings: settings,\n                  pageProps: pageProps,\n                  layout: Component.layout,\n                  config: publicConfig\n                });\n\n              case 24:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x6) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return Application;\n}(App);\n\nexport default _c = withReduxSaga(Application);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["C:/Users/Admin/Desktop/Work/foodiefans/foodiefans-main/user/pages/_app.tsx"],"names":["App","React","Provider","nextCookie","withReduxSaga","BaseLayout","authService","userService","settingService","Router","loginSuccess","updateCurrentUser","updateUIValue","Socket","Head","SETTING_KEYS","pick","updateLiveStreamSettings","updateSettings","setGlobalConfig","redirectLogin","ctx","removeToken","push","res","clearCookie","writeHead","Location","end","auth","noredirect","onlyPerformer","store","state","getState","token","loggedIn","setToken","me","Authorization","user","data","_id","isPerformer","dispatch","updateSettingsStore","settings","logo","logoUrl","siteName","favicon","loginPlaceholderImage","menus","footerContent","countries","userBenefit","modelBenefit","VIEWER_URL","PUBLISHER_URL","SUBSCRIBER_URL","OPTION_FOR_BROADCAST","OPTION_FOR_PRIVATE","SECURE_OPTION","ANT_MEDIA_APPNAME","AGORA_APPID","AGORA_ENABLE","REQUIRE_EMAIL_VERIFICATION","TOKEN_CONVERSION_RATE","STRIPE_PUBLISHABLE_KEY","GOOGLE_RECAPTCHA_SITE_KEY","ENABLE_GOOGLE_RECAPTCHA","GOOGLE_CLIENT_ID","TWITTER_CLIENT_ID","PAYMENT_GATEWAY","META_KEYWORDS","META_DESCRIPTION","publicConfig","Application","props","config","Component","pageProps","layout","gaCode","__html","headerScript","maintenanceMode","afterBodyScript","dotenv","require","myEnv","parsed","Object","keys","forEach","key","indexOf","authenticate","Promise","all","setting","getInitialProps"],"mappings":"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","sourcesContent":["import App from 'next/app';\nimport React from 'react';\nimport { Provider } from 'react-redux';\nimport nextCookie from 'next-cookies';\nimport withReduxSaga from '.../redux/withReduxSaga';\nimport { Store } from 'redux';\nimport BaseLayout from '@layouts/base-layout';\nimport {\n  authService, userService, settingService\n} from '@services/index';\nimport Router from 'next/router';\nimport { NextPageContext } from 'next';\nimport { loginSuccess } from '.../redux/auth/actions';\nimport { updateCurrentUser } from '.../redux/user/actions';\nimport { updateUIValue } from '.../redux/ui/actions';\nimport { Socket } from 'src/socket';\nimport Head from 'next/head';\nimport { SETTING_KEYS } from 'src/constants';\nimport { pick } from 'lodash';\nimport { updateLiveStreamSettings } from '.../redux/streaming/actions';\nimport { updateSettings } from '@redux/settings/actions';\nimport '../style/index.less';\nimport { setGlobalConfig } from '@services/config';\n\ndeclare global {\n  interface Window {\n    ReactSocketIO: any;\n    _REDUX_DEVTOOLS_EXTENSION_COMPOSE_: any;\n    iframely: any;\n  }\n}\n\nfunction redirectLogin(ctx: any) {\n  if (process.browser) {\n    authService.removeToken();\n    Router.push('/');\n    return;\n  }\n\n  // fix for production build\n  ctx.res.clearCookie && ctx.res.clearCookie('token');\n  ctx.res.clearCookie && ctx.res.clearCookie('role');\n  ctx.res.writeHead && ctx.res.writeHead(302, { Location: '/' });\n  ctx.res.end && ctx.res.end();\n}\n\nasync function auth(\n  ctx: NextPageContext,\n  noredirect: boolean,\n  onlyPerformer: boolean\n) {\n  try {\n    const { store } = ctx;\n    const state = store.getState();\n    const { token } = nextCookie(ctx);\n    if (state.auth && state.auth.loggedIn) {\n      return;\n    }\n    if (token) {\n      authService.setToken(token);\n      const user = await userService.me({\n        Authorization: token\n      });\n      if (!user.data || !user.data._id) {\n        redirectLogin(ctx);\n        return;\n      }\n      if (!user.data.isPerformer && onlyPerformer) {\n        redirectLogin(ctx);\n        return;\n      }\n      store.dispatch(loginSuccess());\n      store.dispatch(updateCurrentUser(user.data));\n      return;\n    }\n\n    !noredirect && redirectLogin(ctx);\n  } catch (e) {\n    redirectLogin(ctx);\n  }\n}\n\nasync function updateSettingsStore(ctx: NextPageContext, settings) {\n  const { store } = ctx;\n  store.dispatch(\n    updateUIValue({\n      logo: settings.logoUrl || '',\n      siteName: settings.siteName || '',\n      favicon: settings.favicon || '',\n      loginPlaceholderImage: settings.loginPlaceholderImage || '',\n      menus: settings.menus || [],\n      footerContent: settings.footerContent || '',\n      countries: settings.countries || [],\n      userBenefit: settings.userBenefit || '',\n      modelBenefit: settings.modelBenefit || ''\n    })\n  );\n  store.dispatch(\n    updateLiveStreamSettings(\n      pick(settings, [\n        SETTING_KEYS.VIEWER_URL,\n        SETTING_KEYS.PUBLISHER_URL,\n        SETTING_KEYS.SUBSCRIBER_URL,\n        SETTING_KEYS.OPTION_FOR_BROADCAST,\n        SETTING_KEYS.OPTION_FOR_PRIVATE,\n        SETTING_KEYS.SECURE_OPTION,\n        SETTING_KEYS.ANT_MEDIA_APPNAME,\n        SETTING_KEYS.AGORA_APPID,\n        SETTING_KEYS.AGORA_ENABLE\n      ])\n    )\n  );\n\n  store.dispatch(\n    updateSettings(\n      pick(settings, [\n        SETTING_KEYS.REQUIRE_EMAIL_VERIFICATION,\n        SETTING_KEYS.TOKEN_CONVERSION_RATE,\n        SETTING_KEYS.STRIPE_PUBLISHABLE_KEY,\n        SETTING_KEYS.GOOGLE_RECAPTCHA_SITE_KEY,\n        SETTING_KEYS.ENABLE_GOOGLE_RECAPTCHA,\n        SETTING_KEYS.GOOGLE_CLIENT_ID,\n        SETTING_KEYS.TWITTER_CLIENT_ID,\n        SETTING_KEYS.PAYMENT_GATEWAY,\n        SETTING_KEYS.META_KEYWORDS,\n        SETTING_KEYS.META_DESCRIPTION\n      ])\n    )\n  );\n}\n\ninterface AppComponent extends NextPageContext {\n  layout: string;\n}\n\ninterface IApp {\n  store: Store;\n  layout: string;\n  Component: AppComponent;\n  settings: any;\n  config: any;\n}\n\nconst publicConfig = {} as any;\nclass Application extends App<IApp> {\n  // TODO - consider if we need to use get static props in children component instead?\n  // or check in render?\n  static async getInitialProps({ Component, ctx }) {\n    // load configuration from ENV and put to config\n    if (!process.browser) {\n      // eslint-disable-next-line global-require\n      const dotenv = require('dotenv');\n      const myEnv = dotenv.config().parsed;\n\n      // publish to server config with app\n      setGlobalConfig(myEnv);\n\n      // load public config and api-endpoint?\n      Object.keys(myEnv).forEach((key) => {\n        if (key.indexOf('NEXT_PUBLIC_') === 0) {\n          publicConfig[key] = myEnv[key];\n        }\n      });\n    }\n\n    // won't check auth for un-authenticated page such as login, register\n    // use static field in the component\n    const { noredirect, onlyPerformer, authenticate } = Component;\n    if (authenticate !== false) {\n      await auth(ctx, noredirect, onlyPerformer);\n    }\n    const { token } = nextCookie(ctx);\n    ctx.token = token || '';\n    // server side to load settings, once time only\n    let settings = {};\n    if (!process.browser) {\n      const [setting] = await Promise.all([\n        settingService.all('all', true)\n      ]);\n      settings = { ...setting.data };\n      await updateSettingsStore(ctx, settings);\n    }\n    let pageProps = {};\n    if (Component.getInitialProps) {\n      pageProps = await Component.getInitialProps({ ctx });\n    }\n    return {\n      settings,\n      pageProps,\n      layout: Component.layout,\n      config: publicConfig\n    };\n  }\n\n  constructor(props) {\n    super(props);\n    setGlobalConfig(this.props.config);\n  }\n\n  render() {\n    const {\n      Component, pageProps, store, settings\n    } = this.props;\n    const { layout } = Component;\n    return (\n      <Provider store={store}>\n        <Head>\n          <title>{settings?.siteName}</title>\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1\" />\n          {/* GA code */}\n          {settings && settings.gaCode && [\n            <script async src={`https://www.googletagmanager.com/gtag/js?id=${settings.gaCode}`} />,\n            <script\n              // eslint-disable-next-line react/no-danger\n              dangerouslySetInnerHTML={{\n                __html: `\n                 window.dataLayer = window.dataLayer || [];\n                 function gtag(){dataLayer.push(arguments);}\n                 gtag('js', new Date());\n                 gtag('config', '${settings.gaCode}');\n             `\n              }}\n            />\n          ]}\n          {/* extra script */}\n          {settings && settings.headerScript && (\n            // eslint-disable-next-line react/no-danger\n            <div dangerouslySetInnerHTML={{ __html: settings.headerScript }} />\n          )}\n        </Head>\n        <Socket>\n          <BaseLayout layout={layout} maintenance={settings.maintenanceMode}>\n            <Component {...pageProps} />\n          </BaseLayout>\n        </Socket>\n        {settings && settings.afterBodyScript && (\n          // eslint-disable-next-line react/no-danger\n          <div dangerouslySetInnerHTML={{ __html: settings.afterBodyScript }} />\n        )}\n      </Provider>\n    );\n  }\n}\n\nexport default withReduxSaga(Application);"]},"metadata":{},"sourceType":"module"}