{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\n/* eslint-disable no-prototype-builtins */\nimport { PureComponent } from 'react';\nimport { Menu, Dropdown, message } from 'antd';\nimport { HeartOutlined, MoreOutlined, CaretUpOutlined } from '@ant-design/icons';\nimport { reactionService } from '@services/index';\nimport moment from 'moment';\nimport { connect } from 'react-redux';\nimport { CommentForm, ListComments } from '@components/comment';\nimport { getComments, moreComment, createComment, deleteComment } from '@redux/comment/actions';\n\nvar CommentItem = /*#__PURE__*/function (_PureComponent) {\n  _inherits(CommentItem, _PureComponent);\n\n  var _super = _createSuper(CommentItem);\n\n  function CommentItem() {\n    var _this;\n\n    _classCallCheck(this, CommentItem);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isLiked: false,\n      isOpenComment: false,\n      isFirstLoadComment: true,\n      itemPerPage: 10,\n      commentPage: 0,\n      isReply: false,\n      totalReply: 0,\n      totalLike: 0\n    });\n\n    return _this;\n  }\n\n  _createClass(CommentItem, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var item = this.props.item;\n\n      if (item) {\n        this.setState({\n          isLiked: !!item.isLiked,\n          totalLike: item.totalLike || 0,\n          totalReply: item.totalReply ? item.totalReply : 0\n        });\n      }\n    }\n  }, {\n    key: \"handleComment\",\n    value: function () {\n      var _handleComment = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(values) {\n        var handleCreate, totalReply;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                handleCreate = this.props.createComment;\n                totalReply = this.state.totalReply;\n                handleCreate(values);\n                _context.next = 5;\n                return this.setState({\n                  isReply: false,\n                  isOpenComment: false,\n                  totalReply: totalReply + 1\n                });\n\n              case 5:\n                this.onOpenComment();\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function handleComment(_x) {\n        return _handleComment.apply(this, arguments);\n      }\n\n      return handleComment;\n    }()\n  }, {\n    key: \"onOpenComment\",\n    value: function () {\n      var _onOpenComment = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _this$props, item, handleGetComment, _this$state, isOpenComment, isFirstLoadComment, itemPerPage, commentPage;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this$props = this.props, item = _this$props.item, handleGetComment = _this$props.getComments;\n                _this$state = this.state, isOpenComment = _this$state.isOpenComment, isFirstLoadComment = _this$state.isFirstLoadComment, itemPerPage = _this$state.itemPerPage, commentPage = _this$state.commentPage;\n                this.setState({\n                  isOpenComment: !isOpenComment\n                });\n\n                if (!isFirstLoadComment) {\n                  _context2.next = 7;\n                  break;\n                }\n\n                _context2.next = 6;\n                return this.setState({\n                  isFirstLoadComment: false\n                });\n\n              case 6:\n                handleGetComment({\n                  objectId: item._id,\n                  objectType: 'comment',\n                  limit: itemPerPage,\n                  offset: commentPage\n                });\n\n              case 7:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function onOpenComment() {\n        return _onOpenComment.apply(this, arguments);\n      }\n\n      return onOpenComment;\n    }()\n  }, {\n    key: \"onLikeComment\",\n    value: function () {\n      var _onLikeComment = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(comment) {\n        var _this$state2, isLiked, totalLike, error;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _this$state2 = this.state, isLiked = _this$state2.isLiked, totalLike = _this$state2.totalLike;\n                _context3.prev = 1;\n\n                if (isLiked) {\n                  _context3.next = 8;\n                  break;\n                }\n\n                _context3.next = 5;\n                return reactionService.create({\n                  objectId: comment._id,\n                  action: 'like',\n                  objectType: 'comment'\n                });\n\n              case 5:\n                this.setState({\n                  isLiked: true,\n                  totalLike: totalLike + 1\n                });\n                _context3.next = 11;\n                break;\n\n              case 8:\n                _context3.next = 10;\n                return reactionService[\"delete\"]({\n                  objectId: comment._id,\n                  action: 'like',\n                  objectType: 'comment'\n                });\n\n              case 10:\n                this.setState({\n                  isLiked: false,\n                  totalLike: totalLike - 1\n                });\n\n              case 11:\n                _context3.next = 19;\n                break;\n\n              case 13:\n                _context3.prev = 13;\n                _context3.t0 = _context3[\"catch\"](1);\n                _context3.next = 17;\n                return _context3.t0;\n\n              case 17:\n                error = _context3.sent;\n                message.error(error.message || 'Error occured, please try again later');\n\n              case 19:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[1, 13]]);\n      }));\n\n      function onLikeComment(_x2) {\n        return _onLikeComment.apply(this, arguments);\n      }\n\n      return onLikeComment;\n    }()\n  }, {\n    key: \"moreComment\",\n    value: function () {\n      var _moreComment = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var _this$props2, item, handleLoadMore, _this$state3, commentPage, itemPerPage;\n\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _this$props2 = this.props, item = _this$props2.item, handleLoadMore = _this$props2.moreComment;\n                _this$state3 = this.state, commentPage = _this$state3.commentPage, itemPerPage = _this$state3.itemPerPage;\n                _context4.next = 4;\n                return this.setState({\n                  commentPage: commentPage + 1\n                });\n\n              case 4:\n                handleLoadMore({\n                  limit: itemPerPage,\n                  objectType: 'comment',\n                  offset: (commentPage + 1) * itemPerPage,\n                  objectId: item._id\n                });\n\n              case 5:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function moreComment() {\n        return _moreComment.apply(this, arguments);\n      }\n\n      return moreComment;\n    }()\n  }, {\n    key: \"deleteComment\",\n    value: function () {\n      var _deleteComment = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(item) {\n        var handleDelete;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                handleDelete = this.props.deleteComment;\n\n                if (window.confirm('Are you sure to remove this comment?')) {\n                  _context5.next = 3;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\");\n\n              case 3:\n                handleDelete(item._id);\n\n              case 4:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function deleteComment(_x3) {\n        return _deleteComment.apply(this, arguments);\n      }\n\n      return deleteComment;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _item$creator,\n          _item$creator2,\n          _item$creator3,\n          _this2 = this;\n\n      var _this$props3 = this.props,\n          item = _this$props3.item,\n          user = _this$props3.user,\n          canReply = _this$props3.canReply,\n          onDelete = _this$props3.onDelete,\n          commentMapping = _this$props3.commentMapping,\n          comment = _this$props3.comment,\n          siteName = _this$props3.siteName;\n      var commenting = comment.requesting;\n      var fetchingComment = commentMapping.hasOwnProperty(item._id) ? commentMapping[item._id].requesting : false;\n      var comments = commentMapping.hasOwnProperty(item._id) ? commentMapping[item._id].items : [];\n      var totalComments = commentMapping.hasOwnProperty(item._id) ? commentMapping[item._id].total : 0;\n      var _this$state4 = this.state,\n          isLiked = _this$state4.isLiked,\n          isOpenComment = _this$state4.isOpenComment,\n          isReply = _this$state4.isReply,\n          totalReply = _this$state4.totalReply,\n          totalLike = _this$state4.totalLike;\n      return __jsx(\"div\", null, __jsx(\"div\", {\n        className: \"cmt-item\",\n        key: item._id\n      }, __jsx(\"img\", {\n        alt: \"creator-avt\",\n        src: (item === null || item === void 0 ? void 0 : (_item$creator = item.creator) === null || _item$creator === void 0 ? void 0 : _item$creator.avatar) || '/static/no-avatar.png'\n      }), __jsx(\"div\", {\n        className: \"cmt-content\"\n      }, __jsx(\"div\", {\n        className: \"cmt-user\"\n      }, __jsx(\"span\", null, __jsx(\"span\", null, (item === null || item === void 0 ? void 0 : (_item$creator2 = item.creator) === null || _item$creator2 === void 0 ? void 0 : _item$creator2.name) || (item === null || item === void 0 ? void 0 : (_item$creator3 = item.creator) === null || _item$creator3 === void 0 ? void 0 : _item$creator3.username) || 'N/A'), __jsx(\"span\", {\n        className: \"cmt-time\"\n      }, moment(item.createdAt).fromNow())), user._id === item.createdBy && __jsx(Dropdown, {\n        overlay: __jsx(Menu, {\n          key: \"menu_cmt_\".concat(item._id)\n        }, __jsx(Menu.Item, {\n          key: \"delete_cmt_\".concat(item._id),\n          onClick: function onClick() {\n            return onDelete(item);\n          }\n        }, __jsx(\"a\", null, \"Delete\")))\n      }, __jsx(\"a\", {\n        \"aria-hidden\": true,\n        className: \"ant-dropdown-link\",\n        onClick: function onClick(e) {\n          return e.preventDefault();\n        }\n      }, __jsx(MoreOutlined, null)))), __jsx(\"p\", {\n        className: \"cmt-text\"\n      }, item.content), __jsx(\"div\", {\n        className: \"cmt-action\"\n      }, __jsx(\"a\", {\n        \"aria-hidden\": true,\n        className: isLiked ? 'cmt-like active' : 'cmt-like',\n        onClick: this.onLikeComment.bind(this, item)\n      }, __jsx(HeartOutlined, null), ' ', totalLike > 0 && totalLike), canReply && __jsx(\"a\", {\n        \"aria-hidden\": true,\n        className: !isReply ? 'cmt-reply' : 'cmt-reply active',\n        onClick: function onClick() {\n          return _this2.setState({\n            isReply: !isReply\n          });\n        }\n      }, \"Reply\")), __jsx(\"div\", {\n        className: isReply ? 'reply-bl-form active' : 'reply-bl-form'\n      }, __jsx(\"div\", {\n        className: \"feed-comment\"\n      }, __jsx(CommentForm, {\n        creator: user,\n        onSubmit: this.handleComment.bind(this),\n        objectId: item._id,\n        objectType: \"comment\",\n        requesting: commenting,\n        isReply: true,\n        siteName: siteName\n      }))), canReply && totalReply > 0 && __jsx(\"div\", {\n        className: \"view-cmt\"\n      }, __jsx(\"a\", {\n        \"aria-hidden\": true,\n        onClick: this.onOpenComment.bind(this)\n      }, ' ', __jsx(CaretUpOutlined, {\n        rotate: !isOpenComment ? 180 : 0\n      }), ' ', !isOpenComment ? 'View' : 'Hide', ' ', \"reply\")))), isOpenComment && __jsx(\"div\", {\n        className: \"reply-bl-list\"\n      }, __jsx(\"div\", null, __jsx(ListComments, {\n        key: \"list_comments_\".concat(item._id, \"_\").concat(comments.length),\n        requesting: fetchingComment,\n        comments: comments,\n        total: totalComments,\n        onDelete: this.deleteComment.bind(this),\n        user: user,\n        canReply: false\n      }), comments.length < totalComments && __jsx(\"p\", {\n        className: \"text-center\"\n      }, __jsx(\"a\", {\n        \"aria-hidden\": true,\n        onClick: this.moreComment.bind(this)\n      }, \"more...\")))));\n    }\n  }]);\n\n  return CommentItem;\n}(PureComponent);\n\nvar mapStates = function mapStates(state) {\n  var _state$comment = state.comment,\n      commentMapping = _state$comment.commentMapping,\n      comment = _state$comment.comment;\n  return {\n    commentMapping: commentMapping,\n    comment: comment,\n    siteName: state.ui.siteName\n  };\n};\n\nvar mapDispatch = {\n  getComments: getComments,\n  moreComment: moreComment,\n  createComment: createComment,\n  deleteComment: deleteComment\n};\nexport default connect(mapStates, mapDispatch)(CommentItem);","map":{"version":3,"sources":["c:/Users/Admin/Desktop/Work/foodiefans/foodiefans-main/user/src/components/comment/comment-item.tsx"],"names":["PureComponent","Menu","Dropdown","message","HeartOutlined","MoreOutlined","CaretUpOutlined","reactionService","moment","connect","CommentForm","ListComments","getComments","moreComment","createComment","deleteComment","CommentItem","isLiked","isOpenComment","isFirstLoadComment","itemPerPage","commentPage","isReply","totalReply","totalLike","item","props","setState","values","handleCreate","state","onOpenComment","handleGetComment","objectId","_id","objectType","limit","offset","comment","create","action","error","handleLoadMore","handleDelete","window","confirm","user","canReply","onDelete","commentMapping","siteName","commenting","requesting","fetchingComment","hasOwnProperty","comments","items","totalComments","total","creator","avatar","name","username","createdAt","fromNow","createdBy","e","preventDefault","content","onLikeComment","bind","handleComment","length","mapStates","ui","mapDispatch"],"mappings":"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","sourcesContent":["/* eslint-disable no-prototype-builtins */\nimport { PureComponent } from 'react';\nimport { Menu, Dropdown, message } from 'antd';\nimport { HeartOutlined, MoreOutlined, CaretUpOutlined } from '@ant-design/icons';\nimport { reactionService } from '@services/index';\nimport moment from 'moment';\nimport { connect } from 'react-redux';\nimport { CommentForm, ListComments } from '@components/comment';\nimport {\n  getComments, moreComment, createComment, deleteComment\n} from '@redux/comment/actions';\nimport { IUser, IComment } from 'src/interfaces/index';\n\ninterface IProps {\n  item: IComment;\n  comment: any;\n  onDelete?: Function;\n  user?: IUser;\n  canReply?: boolean;\n  getComments: Function;\n  moreComment: Function;\n  createComment: Function;\n  deleteComment: Function;\n  commentMapping: any;\n  siteName: string;\n}\n\nclass CommentItem extends PureComponent<IProps> {\n  state = {\n    isLiked: false,\n    isOpenComment: false,\n    isFirstLoadComment: true,\n    itemPerPage: 10,\n    commentPage: 0,\n    isReply: false,\n    totalReply: 0,\n    totalLike: 0\n  }\n\n  componentDidMount() {\n    const { item } = this.props;\n    if (item) {\n      this.setState({\n        isLiked: !!item.isLiked,\n        totalLike: item.totalLike || 0,\n        totalReply: item.totalReply ? item.totalReply : 0\n      });\n    }\n  }\n\n  async handleComment(values) {\n    const { createComment: handleCreate } = this.props;\n    const { totalReply } = this.state;\n    handleCreate(values);\n    await this.setState({ isReply: false, isOpenComment: false, totalReply: totalReply + 1 });\n    this.onOpenComment();\n  }\n\n  async onOpenComment() {\n    const { item, getComments: handleGetComment } = this.props;\n    const {\n      isOpenComment, isFirstLoadComment, itemPerPage, commentPage\n    } = this.state;\n    this.setState({ isOpenComment: !isOpenComment });\n    if (isFirstLoadComment) {\n      await this.setState({ isFirstLoadComment: false });\n      handleGetComment({\n        objectId: item._id,\n        objectType: 'comment',\n        limit: itemPerPage,\n        offset: commentPage\n      });\n    }\n  }\n\n  async onLikeComment(comment) {\n    const { isLiked, totalLike } = this.state;\n    try {\n      if (!isLiked) {\n        await reactionService.create({\n          objectId: comment._id,\n          action: 'like',\n          objectType: 'comment'\n        });\n        this.setState({ isLiked: true, totalLike: totalLike + 1 });\n      } else {\n        await reactionService.delete({\n          objectId: comment._id,\n          action: 'like',\n          objectType: 'comment'\n        });\n        this.setState({ isLiked: false, totalLike: totalLike - 1 });\n      }\n    } catch (e) {\n      const error = await e;\n      message.error(error.message || 'Error occured, please try again later');\n    }\n  }\n\n  async moreComment() {\n    const { item, moreComment: handleLoadMore } = this.props;\n    const { commentPage, itemPerPage } = this.state;\n    await this.setState({\n      commentPage: commentPage + 1\n    });\n    handleLoadMore({\n      limit: itemPerPage,\n      objectType: 'comment',\n      offset: (commentPage + 1) * itemPerPage,\n      objectId: item._id\n    });\n  }\n\n  async deleteComment(item) {\n    const { deleteComment: handleDelete } = this.props;\n    if (!window.confirm('Are you sure to remove this comment?')) return;\n    handleDelete(item._id);\n  }\n\n  render() {\n    const {\n      item, user, canReply, onDelete, commentMapping, comment, siteName\n    } = this.props;\n    const { requesting: commenting } = comment;\n    const fetchingComment = commentMapping.hasOwnProperty(item._id) ? commentMapping[item._id].requesting : false;\n    const comments = commentMapping.hasOwnProperty(item._id) ? commentMapping[item._id].items : [];\n    const totalComments = commentMapping.hasOwnProperty(item._id) ? commentMapping[item._id].total : 0;\n    const {\n      isLiked, isOpenComment, isReply, totalReply, totalLike\n    } = this.state;\n    return (\n      <div>\n        <div className=\"cmt-item\" key={item._id}>\n          <img alt=\"creator-avt\" src={item?.creator?.avatar || '/static/no-avatar.png'} />\n          <div className=\"cmt-content\">\n            <div className=\"cmt-user\">\n              <span>\n                <span>{item?.creator?.name || item?.creator?.username || 'N/A'}</span>\n                <span className=\"cmt-time\">{moment(item.createdAt).fromNow()}</span>\n              </span>\n              {user._id === item.createdBy && (\n                <Dropdown overlay={(\n                  <Menu key={`menu_cmt_${item._id}`}>\n                    <Menu.Item key={`delete_cmt_${item._id}`} onClick={() => onDelete(item)}>\n                      <a>\n                        Delete\n                      </a>\n                    </Menu.Item>\n                  </Menu>\n                )}\n                >\n                  <a aria-hidden className=\"ant-dropdown-link\" onClick={(e) => e.preventDefault()}>\n                    <MoreOutlined />\n                  </a>\n                </Dropdown>\n              )}\n            </div>\n            <p className=\"cmt-text\">{item.content}</p>\n            <div className=\"cmt-action\">\n              <a aria-hidden className={isLiked ? 'cmt-like active' : 'cmt-like'} onClick={this.onLikeComment.bind(this, item)}>\n                <HeartOutlined />\n                {' '}\n                {totalLike > 0 && totalLike}\n              </a>\n              {canReply && <a aria-hidden className={!isReply ? 'cmt-reply' : 'cmt-reply active'} onClick={() => this.setState({ isReply: !isReply })}>Reply</a>}\n            </div>\n            <div className={isReply ? 'reply-bl-form active' : 'reply-bl-form'}>\n              <div className=\"feed-comment\">\n                <CommentForm\n                  creator={user}\n                  onSubmit={this.handleComment.bind(this)}\n                  objectId={item._id}\n                  objectType=\"comment\"\n                  requesting={commenting}\n                  isReply\n                  siteName={siteName}\n                />\n              </div>\n            </div>\n            {canReply && totalReply > 0 && (\n              <div className=\"view-cmt\">\n                <a aria-hidden onClick={this.onOpenComment.bind(this)}>\n                  {' '}\n                  <CaretUpOutlined rotate={!isOpenComment ? 180 : 0} />\n                  {' '}\n                  {!isOpenComment ? 'View' : 'Hide'}\n                  {' '}\n                  reply\n                </a>\n              </div>\n            )}\n          </div>\n        </div>\n        {isOpenComment && (\n          <div className=\"reply-bl-list\">\n            <div>\n              <ListComments\n                key={`list_comments_${item._id}_${comments.length}`}\n                requesting={fetchingComment}\n                comments={comments}\n                total={totalComments}\n                onDelete={this.deleteComment.bind(this)}\n                user={user}\n                canReply={false}\n              />\n              {comments.length < totalComments && <p className=\"text-center\"><a aria-hidden onClick={this.moreComment.bind(this)}>more...</a></p>}\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nconst mapStates = (state: any) => {\n  const { commentMapping, comment } = state.comment;\n  return {\n    commentMapping,\n    comment,\n    siteName: state.ui.siteName\n  };\n};\n\nconst mapDispatch = {\n  getComments, moreComment, createComment, deleteComment\n};\nexport default connect(mapStates, mapDispatch)(CommentItem);\n"]},"metadata":{},"sourceType":"module"}